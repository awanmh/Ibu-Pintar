{"ast":null,"code":"import { ref, onMounted, computed } from 'vue';\nimport { useRoute, useRouter } from 'vue-router';\nimport { useStore } from 'vuex';\nimport ApiService from '@/services/ApiService';\nimport AppButton from '@/components/common/AppButton.vue';\nexport default {\n  __name: 'ArticleForm',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const route = useRoute();\n    const router = useRouter();\n    const store = useStore();\n    const article = ref({\n      title: '',\n      content: '',\n      imageUrl: '',\n      category_id: ''\n    });\n    const categories = ref([]);\n    const isEditing = computed(() => !!route.params.id);\n\n    // ### LOGIKA BARU UNTUK NAMA PENULIS ###\n    const authorName = computed(() => store.getters['auth/currentUser']?.name || 'Admin');\n\n    // State baru untuk upload gambar\n    const selectedFile = ref(null);\n    const imagePreview = ref('');\n    const isUploading = ref(false);\n\n    // Fungsi untuk menangani pemilihan file\n    const handleFileChange = event => {\n      const file = event.target.files[0];\n      if (file) {\n        selectedFile.value = file;\n        // Buat URL sementara untuk ditampilkan sebagai preview\n        imagePreview.value = URL.createObjectURL(file);\n      }\n    };\n    onMounted(async () => {\n      // Ambil daftar kategori untuk dropdown\n      try {\n        const catResponse = await ApiService.getCategories();\n        categories.value = catResponse.data;\n      } catch (error) {\n        console.error(\"Gagal mengambil kategori:\", error);\n      }\n\n      // Jika ini mode edit, ambil data artikel yang ada\n      if (isEditing.value) {\n        try {\n          const artResponse = await ApiService.getArticle(route.params.id);\n          article.value = artResponse.data;\n        } catch (error) {\n          console.error(\"Gagal mengambil artikel untuk diedit:\", error);\n        }\n      }\n    });\n\n    // Fungsi yang dijalankan saat form disubmit\n    const handleSubmit = async () => {\n      isUploading.value = true;\n      let imageUrl = article.value.imageUrl; // Simpan URL gambar yang sudah ada (untuk mode edit)\n\n      // 1. Jika ada file baru yang dipilih, unggah dulu\n      if (selectedFile.value) {\n        const formData = new FormData();\n        formData.append('image', selectedFile.value);\n        try {\n          const uploadResponse = await ApiService.uploadImage(formData);\n          imageUrl = uploadResponse.data.imagePath; // Dapatkan path gambar baru dari backend\n        } catch (error) {\n          console.error(\"Gagal mengunggah gambar:\", error);\n          alert(\"Gagal mengunggah gambar. Pastikan file adalah gambar (jpg/png).\");\n          isUploading.value = false;\n          return;\n        }\n      }\n\n      // 2. Siapkan payload data artikel\n      const author_id = store.getters['auth/currentUser']?.id;\n      if (!author_id) {\n        alert(\"Sesi admin tidak valid. Silakan login ulang.\");\n        isUploading.value = false;\n        return;\n      }\n      const payload = {\n        ...article.value,\n        imageUrl,\n        author_id\n      };\n\n      // 3. Kirim data artikel ke backend (create atau update)\n      try {\n        if (isEditing.value) {\n          await ApiService.updateArticle(route.params.id, payload);\n        } else {\n          await ApiService.createArticle(payload);\n        }\n        // Arahkan kembali ke halaman manajemen artikel setelah berhasil\n        router.push('/admin/articles');\n      } catch (error) {\n        console.error(\"Gagal menyimpan artikel:\", error);\n        alert(\"Terjadi kesalahan saat menyimpan artikel.\");\n      } finally {\n        isUploading.value = false;\n      }\n    };\n    const __returned__ = {\n      route,\n      router,\n      store,\n      article,\n      categories,\n      isEditing,\n      authorName,\n      selectedFile,\n      imagePreview,\n      isUploading,\n      handleFileChange,\n      handleSubmit,\n      ref,\n      onMounted,\n      computed,\n      get useRoute() {\n        return useRoute;\n      },\n      get useRouter() {\n        return useRouter;\n      },\n      get useStore() {\n        return useStore;\n      },\n      get ApiService() {\n        return ApiService;\n      },\n      AppButton\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","onMounted","computed","useRoute","useRouter","useStore","ApiService","AppButton","route","router","store","article","title","content","imageUrl","category_id","categories","isEditing","params","id","authorName","getters","name","selectedFile","imagePreview","isUploading","handleFileChange","event","file","target","files","value","URL","createObjectURL","catResponse","getCategories","data","error","console","artResponse","getArticle","handleSubmit","formData","FormData","append","uploadResponse","uploadImage","imagePath","alert","author_id","payload","updateArticle","createArticle","push"],"sources":["E:/ibuPintar/frontend/src/views/admin/ArticleForm.vue"],"sourcesContent":["<template>\r\n  <div>\r\n    <h1>{{ isEditing ? 'Edit Artikel' : 'Tambah Artikel Baru' }}</h1>\r\n    <form @submit.prevent=\"handleSubmit\" class=\"article-form\">\r\n      <div class=\"form-group\">\r\n        <label for=\"title\">Judul Artikel</label>\r\n        <input type=\"text\" id=\"title\" v-model=\"article.title\" required>\r\n      </div>\r\n\r\n      <!-- ### BAGIAN BARU DITAMBAHKAN DI SINI ### -->\r\n      <div class=\"form-group\">\r\n        <label for=\"author\">Penulis</label>\r\n        <!-- Input ini dinonaktifkan karena nama penulis diambil otomatis dari user yang login -->\r\n        <input type=\"text\" id=\"author\" :value=\"authorName\" readonly disabled>\r\n      </div>\r\n\r\n      <!-- Input untuk Upload Gambar -->\r\n      <div class=\"form-group\">\r\n        <label for=\"imageUpload\">Upload Gambar Sampul</label>\r\n        <input type=\"file\" id=\"imageUpload\" @change=\"handleFileChange\" accept=\"image/png, image/jpeg, image/jpg\">\r\n        \r\n        <!-- Area Preview Gambar -->\r\n        <div v-if=\"imagePreview\" class=\"image-preview\">\r\n          <p>Preview Gambar Baru:</p>\r\n          <img :src=\"imagePreview\" alt=\"Preview Gambar\">\r\n        </div>\r\n        <!-- Tampilkan gambar yang sudah ada saat mode edit -->\r\n        <div v-else-if=\"isEditing && article.imageUrl\" class=\"image-preview\">\r\n            <p>Gambar Saat Ini:</p>\r\n            <img :src=\"`http://localhost:5000${article.imageUrl}`\" alt=\"Gambar Artikel\">\r\n        </div>\r\n      </div>\r\n      \r\n      <div class=\"form-group\">\r\n        <label for=\"category\">Kategori</label>\r\n        <select id=\"category\" v-model=\"article.category_id\" required>\r\n          <option disabled value=\"\">Pilih kategori...</option>\r\n          <option v-for=\"cat in categories\" :key=\"cat.id\" :value=\"cat.id\">\r\n            {{ cat.name }}\r\n          </option>\r\n        </select>\r\n      </div>\r\n      <div class=\"form-group\">\r\n        <label for=\"content\">Konten</label>\r\n        <textarea id=\"content\" v-model=\"article.content\" rows=\"15\" required></textarea>\r\n      </div>\r\n      <AppButton type=\"submit\" variant=\"primary\" :disabled=\"isUploading\">\r\n        {{ isUploading ? 'Menyimpan...' : (isEditing ? 'Simpan Perubahan' : 'Publikasikan Artikel') }}\r\n      </AppButton>\r\n    </form>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, onMounted, computed } from 'vue';\r\nimport { useRoute, useRouter } from 'vue-router';\r\nimport { useStore } from 'vuex';\r\nimport ApiService from '@/services/ApiService';\r\nimport AppButton from '@/components/common/AppButton.vue';\r\n\r\nconst route = useRoute();\r\nconst router = useRouter();\r\nconst store = useStore();\r\n\r\nconst article = ref({\r\n  title: '',\r\n  content: '',\r\n  imageUrl: '',\r\n  category_id: '',\r\n});\r\nconst categories = ref([]);\r\nconst isEditing = computed(() => !!route.params.id);\r\n\r\n// ### LOGIKA BARU UNTUK NAMA PENULIS ###\r\nconst authorName = computed(() => store.getters['auth/currentUser']?.name || 'Admin');\r\n\r\n// State baru untuk upload gambar\r\nconst selectedFile = ref(null);\r\nconst imagePreview = ref('');\r\nconst isUploading = ref(false);\r\n\r\n// Fungsi untuk menangani pemilihan file\r\nconst handleFileChange = (event) => {\r\n  const file = event.target.files[0];\r\n  if (file) {\r\n    selectedFile.value = file;\r\n    // Buat URL sementara untuk ditampilkan sebagai preview\r\n    imagePreview.value = URL.createObjectURL(file);\r\n  }\r\n};\r\n\r\nonMounted(async () => {\r\n  // Ambil daftar kategori untuk dropdown\r\n  try {\r\n    const catResponse = await ApiService.getCategories();\r\n    categories.value = catResponse.data;\r\n  } catch (error) {\r\n    console.error(\"Gagal mengambil kategori:\", error);\r\n  }\r\n\r\n  // Jika ini mode edit, ambil data artikel yang ada\r\n  if (isEditing.value) {\r\n    try {\r\n      const artResponse = await ApiService.getArticle(route.params.id);\r\n      article.value = artResponse.data;\r\n    } catch (error) {\r\n      console.error(\"Gagal mengambil artikel untuk diedit:\", error);\r\n    }\r\n  }\r\n});\r\n\r\n// Fungsi yang dijalankan saat form disubmit\r\nconst handleSubmit = async () => {\r\n  isUploading.value = true;\r\n  let imageUrl = article.value.imageUrl; // Simpan URL gambar yang sudah ada (untuk mode edit)\r\n\r\n  // 1. Jika ada file baru yang dipilih, unggah dulu\r\n  if (selectedFile.value) {\r\n    const formData = new FormData();\r\n    formData.append('image', selectedFile.value);\r\n    try {\r\n      const uploadResponse = await ApiService.uploadImage(formData);\r\n      imageUrl = uploadResponse.data.imagePath; // Dapatkan path gambar baru dari backend\r\n    } catch (error) {\r\n      console.error(\"Gagal mengunggah gambar:\", error);\r\n      alert(\"Gagal mengunggah gambar. Pastikan file adalah gambar (jpg/png).\");\r\n      isUploading.value = false;\r\n      return;\r\n    }\r\n  }\r\n\r\n  // 2. Siapkan payload data artikel\r\n  const author_id = store.getters['auth/currentUser']?.id;\r\n  if (!author_id) {\r\n    alert(\"Sesi admin tidak valid. Silakan login ulang.\");\r\n    isUploading.value = false;\r\n    return;\r\n  }\r\n  const payload = { ...article.value, imageUrl, author_id };\r\n\r\n  // 3. Kirim data artikel ke backend (create atau update)\r\n  try {\r\n    if (isEditing.value) {\r\n      await ApiService.updateArticle(route.params.id, payload);\r\n    } else {\r\n      await ApiService.createArticle(payload);\r\n    }\r\n    // Arahkan kembali ke halaman manajemen artikel setelah berhasil\r\n    router.push('/admin/articles');\r\n  } catch (error) {\r\n    console.error(\"Gagal menyimpan artikel:\", error);\r\n    alert(\"Terjadi kesalahan saat menyimpan artikel.\");\r\n  } finally {\r\n    isUploading.value = false;\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.article-form {\r\n  background: white;\r\n  padding: 25px;\r\n  border-radius: 8px;\r\n  box-shadow: 0 2px 10px rgba(0,0,0,0.05);\r\n}\r\n.form-group {\r\n  margin-bottom: 20px;\r\n}\r\n.form-group label {\r\n  display: block;\r\n  margin-bottom: 8px;\r\n  font-weight: 600;\r\n}\r\n.form-group input,\r\n.form-group select,\r\n.form-group textarea {\r\n  width: 100%;\r\n  padding: 12px;\r\n  border: 1px solid #ccc;\r\n  border-radius: 4px;\r\n  font-size: 1rem;\r\n}\r\n/* Style untuk input yang dinonaktifkan */\r\n.form-group input:disabled {\r\n    background-color: #f0f0f0;\r\n    cursor: not-allowed;\r\n}\r\ntextarea {\r\n  min-height: 250px;\r\n  resize: vertical;\r\n}\r\n.image-preview {\r\n  margin-top: 15px;\r\n  border: 1px dashed #ccc;\r\n  padding: 10px;\r\n  border-radius: 8px;\r\n}\r\n.image-preview img {\r\n  max-width: 250px;\r\n  height: auto;\r\n  border-radius: 4px;\r\n  display: block;\r\n}\r\n</style>\r\n"],"mappings":"AAsDA,SAASA,GAAG,EAAEC,SAAS,EAAEC,QAAQ,QAAQ,KAAK;AAC9C,SAASC,QAAQ,EAAEC,SAAS,QAAQ,YAAY;AAChD,SAASC,QAAQ,QAAQ,MAAM;AAC/B,OAAOC,UAAU,MAAM,uBAAuB;AAC9C,OAAOC,SAAS,MAAM,mCAAmC;;;;;;;IAEzD,MAAMC,KAAK,GAAGL,QAAQ,CAAC,CAAC;IACxB,MAAMM,MAAM,GAAGL,SAAS,CAAC,CAAC;IAC1B,MAAMM,KAAK,GAAGL,QAAQ,CAAC,CAAC;IAExB,MAAMM,OAAO,GAAGX,GAAG,CAAC;MAClBY,KAAK,EAAE,EAAE;MACTC,OAAO,EAAE,EAAE;MACXC,QAAQ,EAAE,EAAE;MACZC,WAAW,EAAE;IACf,CAAC,CAAC;IACF,MAAMC,UAAU,GAAGhB,GAAG,CAAC,EAAE,CAAC;IAC1B,MAAMiB,SAAS,GAAGf,QAAQ,CAAC,MAAM,CAAC,CAACM,KAAK,CAACU,MAAM,CAACC,EAAE,CAAC;;IAEnD;IACA,MAAMC,UAAU,GAAGlB,QAAQ,CAAC,MAAMQ,KAAK,CAACW,OAAO,CAAC,kBAAkB,CAAC,EAAEC,IAAI,IAAI,OAAO,CAAC;;IAErF;IACA,MAAMC,YAAY,GAAGvB,GAAG,CAAC,IAAI,CAAC;IAC9B,MAAMwB,YAAY,GAAGxB,GAAG,CAAC,EAAE,CAAC;IAC5B,MAAMyB,WAAW,GAAGzB,GAAG,CAAC,KAAK,CAAC;;IAE9B;IACA,MAAM0B,gBAAgB,GAAIC,KAAK,IAAK;MAClC,MAAMC,IAAI,GAAGD,KAAK,CAACE,MAAM,CAACC,KAAK,CAAC,CAAC,CAAC;MAClC,IAAIF,IAAI,EAAE;QACRL,YAAY,CAACQ,KAAK,GAAGH,IAAI;QACzB;QACAJ,YAAY,CAACO,KAAK,GAAGC,GAAG,CAACC,eAAe,CAACL,IAAI,CAAC;MAChD;IACF,CAAC;IAED3B,SAAS,CAAC,YAAY;MACpB;MACA,IAAI;QACF,MAAMiC,WAAW,GAAG,MAAM5B,UAAU,CAAC6B,aAAa,CAAC,CAAC;QACpDnB,UAAU,CAACe,KAAK,GAAGG,WAAW,CAACE,IAAI;MACrC,CAAC,CAAC,OAAOC,KAAK,EAAE;QACdC,OAAO,CAACD,KAAK,CAAC,2BAA2B,EAAEA,KAAK,CAAC;MACnD;;MAEA;MACA,IAAIpB,SAAS,CAACc,KAAK,EAAE;QACnB,IAAI;UACF,MAAMQ,WAAW,GAAG,MAAMjC,UAAU,CAACkC,UAAU,CAAChC,KAAK,CAACU,MAAM,CAACC,EAAE,CAAC;UAChER,OAAO,CAACoB,KAAK,GAAGQ,WAAW,CAACH,IAAI;QAClC,CAAC,CAAC,OAAOC,KAAK,EAAE;UACdC,OAAO,CAACD,KAAK,CAAC,uCAAuC,EAAEA,KAAK,CAAC;QAC/D;MACF;IACF,CAAC,CAAC;;IAEF;IACA,MAAMI,YAAY,GAAG,MAAAA,CAAA,KAAY;MAC/BhB,WAAW,CAACM,KAAK,GAAG,IAAI;MACxB,IAAIjB,QAAQ,GAAGH,OAAO,CAACoB,KAAK,CAACjB,QAAQ,CAAC,CAAC;;MAEvC;MACA,IAAIS,YAAY,CAACQ,KAAK,EAAE;QACtB,MAAMW,QAAQ,GAAG,IAAIC,QAAQ,CAAC,CAAC;QAC/BD,QAAQ,CAACE,MAAM,CAAC,OAAO,EAAErB,YAAY,CAACQ,KAAK,CAAC;QAC5C,IAAI;UACF,MAAMc,cAAc,GAAG,MAAMvC,UAAU,CAACwC,WAAW,CAACJ,QAAQ,CAAC;UAC7D5B,QAAQ,GAAG+B,cAAc,CAACT,IAAI,CAACW,SAAS,CAAC,CAAC;QAC5C,CAAC,CAAC,OAAOV,KAAK,EAAE;UACdC,OAAO,CAACD,KAAK,CAAC,0BAA0B,EAAEA,KAAK,CAAC;UAChDW,KAAK,CAAC,iEAAiE,CAAC;UACxEvB,WAAW,CAACM,KAAK,GAAG,KAAK;UACzB;QACF;MACF;;MAEA;MACA,MAAMkB,SAAS,GAAGvC,KAAK,CAACW,OAAO,CAAC,kBAAkB,CAAC,EAAEF,EAAE;MACvD,IAAI,CAAC8B,SAAS,EAAE;QACdD,KAAK,CAAC,8CAA8C,CAAC;QACrDvB,WAAW,CAACM,KAAK,GAAG,KAAK;QACzB;MACF;MACA,MAAMmB,OAAO,GAAG;QAAE,GAAGvC,OAAO,CAACoB,KAAK;QAAEjB,QAAQ;QAAEmC;MAAU,CAAC;;MAEzD;MACA,IAAI;QACF,IAAIhC,SAAS,CAACc,KAAK,EAAE;UACnB,MAAMzB,UAAU,CAAC6C,aAAa,CAAC3C,KAAK,CAACU,MAAM,CAACC,EAAE,EAAE+B,OAAO,CAAC;QAC1D,CAAC,MAAM;UACL,MAAM5C,UAAU,CAAC8C,aAAa,CAACF,OAAO,CAAC;QACzC;QACA;QACAzC,MAAM,CAAC4C,IAAI,CAAC,iBAAiB,CAAC;MAChC,CAAC,CAAC,OAAOhB,KAAK,EAAE;QACdC,OAAO,CAACD,KAAK,CAAC,0BAA0B,EAAEA,KAAK,CAAC;QAChDW,KAAK,CAAC,2CAA2C,CAAC;MACpD,CAAC,SAAS;QACRvB,WAAW,CAACM,KAAK,GAAG,KAAK;MAC3B;IACF,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}