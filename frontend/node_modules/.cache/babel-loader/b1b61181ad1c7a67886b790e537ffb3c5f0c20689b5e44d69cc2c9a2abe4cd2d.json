{"ast":null,"code":"import { toDisplayString as _toDisplayString, createElementVNode as _createElementVNode, vModelText as _vModelText, withDirectives as _withDirectives, createCommentVNode as _createCommentVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, Fragment as _Fragment, renderList as _renderList, vModelSelect as _vModelSelect, createTextVNode as _createTextVNode, withCtx as _withCtx, createVNode as _createVNode, withModifiers as _withModifiers } from \"vue\";\nconst _hoisted_1 = {\n  class: \"form-group\"\n};\nconst _hoisted_2 = {\n  class: \"form-group\"\n};\nconst _hoisted_3 = [\"value\"];\nconst _hoisted_4 = {\n  class: \"form-group\"\n};\nconst _hoisted_5 = {\n  key: 0,\n  class: \"image-preview\"\n};\nconst _hoisted_6 = [\"src\"];\nconst _hoisted_7 = {\n  class: \"image-preview\"\n};\nconst _hoisted_8 = [\"src\"];\nconst _hoisted_9 = {\n  class: \"form-group\"\n};\nconst _hoisted_10 = [\"value\"];\nconst _hoisted_11 = {\n  class: \"form-group\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createElementBlock(\"div\", null, [_createElementVNode(\"h1\", null, _toDisplayString($setup.isEditing ? 'Edit Artikel' : 'Tambah Artikel Baru'), 1 /* TEXT */), _createElementVNode(\"form\", {\n    onSubmit: _withModifiers($setup.handleSubmit, [\"prevent\"]),\n    class: \"article-form\"\n  }, [_createElementVNode(\"div\", _hoisted_1, [_cache[3] || (_cache[3] = _createElementVNode(\"label\", {\n    for: \"title\"\n  }, \"Judul Artikel\", -1 /* HOISTED */)), _withDirectives(_createElementVNode(\"input\", {\n    type: \"text\",\n    id: \"title\",\n    \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => $setup.article.title = $event),\n    required: \"\"\n  }, null, 512 /* NEED_PATCH */), [[_vModelText, $setup.article.title]])]), _createCommentVNode(\" ### BAGIAN BARU DITAMBAHKAN DI SINI ### \"), _createElementVNode(\"div\", _hoisted_2, [_cache[4] || (_cache[4] = _createElementVNode(\"label\", {\n    for: \"author\"\n  }, \"Penulis\", -1 /* HOISTED */)), _createCommentVNode(\" Input ini dinonaktifkan karena nama penulis diambil otomatis dari user yang login \"), _createElementVNode(\"input\", {\n    type: \"text\",\n    id: \"author\",\n    value: $setup.authorName,\n    readonly: \"\",\n    disabled: \"\"\n  }, null, 8 /* PROPS */, _hoisted_3)]), _createCommentVNode(\" Input untuk Upload Gambar \"), _createElementVNode(\"div\", _hoisted_4, [_cache[7] || (_cache[7] = _createElementVNode(\"label\", {\n    for: \"imageUpload\"\n  }, \"Upload Gambar Sampul\", -1 /* HOISTED */)), _createElementVNode(\"input\", {\n    type: \"file\",\n    id: \"imageUpload\",\n    onChange: $setup.handleFileChange,\n    accept: \"image/png, image/jpeg, image/jpg\"\n  }, null, 32 /* NEED_HYDRATION */), _createCommentVNode(\" Area Preview Gambar \"), $setup.imagePreview ? (_openBlock(), _createElementBlock(\"div\", _hoisted_5, [_cache[5] || (_cache[5] = _createElementVNode(\"p\", null, \"Preview Gambar Baru:\", -1 /* HOISTED */)), _createElementVNode(\"img\", {\n    src: $setup.imagePreview,\n    alt: \"Preview Gambar\"\n  }, null, 8 /* PROPS */, _hoisted_6)])) : $setup.isEditing && $setup.article.imageUrl ? (_openBlock(), _createElementBlock(_Fragment, {\n    key: 1\n  }, [_createCommentVNode(\" Tampilkan gambar yang sudah ada saat mode edit \"), _createElementVNode(\"div\", _hoisted_7, [_cache[6] || (_cache[6] = _createElementVNode(\"p\", null, \"Gambar Saat Ini:\", -1 /* HOISTED */)), _createElementVNode(\"img\", {\n    src: `http://localhost:5000${$setup.article.imageUrl}`,\n    alt: \"Gambar Artikel\"\n  }, null, 8 /* PROPS */, _hoisted_8)])], 2112 /* STABLE_FRAGMENT, DEV_ROOT_FRAGMENT */)) : _createCommentVNode(\"v-if\", true)]), _createElementVNode(\"div\", _hoisted_9, [_cache[9] || (_cache[9] = _createElementVNode(\"label\", {\n    for: \"category\"\n  }, \"Kategori\", -1 /* HOISTED */)), _withDirectives(_createElementVNode(\"select\", {\n    id: \"category\",\n    \"onUpdate:modelValue\": _cache[1] || (_cache[1] = $event => $setup.article.category_id = $event),\n    required: \"\"\n  }, [_cache[8] || (_cache[8] = _createElementVNode(\"option\", {\n    disabled: \"\",\n    value: \"\"\n  }, \"Pilih kategori...\", -1 /* HOISTED */)), (_openBlock(true), _createElementBlock(_Fragment, null, _renderList($setup.categories, cat => {\n    return _openBlock(), _createElementBlock(\"option\", {\n      key: cat.id,\n      value: cat.id\n    }, _toDisplayString(cat.name), 9 /* TEXT, PROPS */, _hoisted_10);\n  }), 128 /* KEYED_FRAGMENT */))], 512 /* NEED_PATCH */), [[_vModelSelect, $setup.article.category_id]])]), _createElementVNode(\"div\", _hoisted_11, [_cache[10] || (_cache[10] = _createElementVNode(\"label\", {\n    for: \"content\"\n  }, \"Konten\", -1 /* HOISTED */)), _withDirectives(_createElementVNode(\"textarea\", {\n    id: \"content\",\n    \"onUpdate:modelValue\": _cache[2] || (_cache[2] = $event => $setup.article.content = $event),\n    rows: \"15\",\n    required: \"\"\n  }, null, 512 /* NEED_PATCH */), [[_vModelText, $setup.article.content]])]), _createVNode($setup[\"AppButton\"], {\n    type: \"submit\",\n    variant: \"primary\",\n    disabled: $setup.isUploading\n  }, {\n    default: _withCtx(() => [_createTextVNode(_toDisplayString($setup.isUploading ? 'Menyimpan...' : $setup.isEditing ? 'Simpan Perubahan' : 'Publikasikan Artikel'), 1 /* TEXT */)]),\n    _: 1 /* STABLE */\n  }, 8 /* PROPS */, [\"disabled\"])], 32 /* NEED_HYDRATION */)]);\n}","map":{"version":3,"names":["class","_createElementBlock","_createElementVNode","_toDisplayString","$setup","isEditing","onSubmit","_withModifiers","handleSubmit","_hoisted_1","for","type","id","article","title","$event","required","_createCommentVNode","_hoisted_2","value","authorName","readonly","disabled","_hoisted_4","onChange","handleFileChange","accept","imagePreview","_hoisted_5","src","alt","imageUrl","_Fragment","key","_hoisted_7","_hoisted_9","category_id","_renderList","categories","cat","name","_hoisted_10","_hoisted_11","content","rows","_createVNode","variant","isUploading"],"sources":["E:\\ibuPintar\\frontend\\src\\views\\admin\\ArticleForm.vue"],"sourcesContent":["<template>\r\n  <div>\r\n    <h1>{{ isEditing ? 'Edit Artikel' : 'Tambah Artikel Baru' }}</h1>\r\n    <form @submit.prevent=\"handleSubmit\" class=\"article-form\">\r\n      <div class=\"form-group\">\r\n        <label for=\"title\">Judul Artikel</label>\r\n        <input type=\"text\" id=\"title\" v-model=\"article.title\" required>\r\n      </div>\r\n\r\n      <!-- ### BAGIAN BARU DITAMBAHKAN DI SINI ### -->\r\n      <div class=\"form-group\">\r\n        <label for=\"author\">Penulis</label>\r\n        <!-- Input ini dinonaktifkan karena nama penulis diambil otomatis dari user yang login -->\r\n        <input type=\"text\" id=\"author\" :value=\"authorName\" readonly disabled>\r\n      </div>\r\n\r\n      <!-- Input untuk Upload Gambar -->\r\n      <div class=\"form-group\">\r\n        <label for=\"imageUpload\">Upload Gambar Sampul</label>\r\n        <input type=\"file\" id=\"imageUpload\" @change=\"handleFileChange\" accept=\"image/png, image/jpeg, image/jpg\">\r\n        \r\n        <!-- Area Preview Gambar -->\r\n        <div v-if=\"imagePreview\" class=\"image-preview\">\r\n          <p>Preview Gambar Baru:</p>\r\n          <img :src=\"imagePreview\" alt=\"Preview Gambar\">\r\n        </div>\r\n        <!-- Tampilkan gambar yang sudah ada saat mode edit -->\r\n        <div v-else-if=\"isEditing && article.imageUrl\" class=\"image-preview\">\r\n            <p>Gambar Saat Ini:</p>\r\n            <img :src=\"`http://localhost:5000${article.imageUrl}`\" alt=\"Gambar Artikel\">\r\n        </div>\r\n      </div>\r\n      \r\n      <div class=\"form-group\">\r\n        <label for=\"category\">Kategori</label>\r\n        <select id=\"category\" v-model=\"article.category_id\" required>\r\n          <option disabled value=\"\">Pilih kategori...</option>\r\n          <option v-for=\"cat in categories\" :key=\"cat.id\" :value=\"cat.id\">\r\n            {{ cat.name }}\r\n          </option>\r\n        </select>\r\n      </div>\r\n      <div class=\"form-group\">\r\n        <label for=\"content\">Konten</label>\r\n        <textarea id=\"content\" v-model=\"article.content\" rows=\"15\" required></textarea>\r\n      </div>\r\n      <AppButton type=\"submit\" variant=\"primary\" :disabled=\"isUploading\">\r\n        {{ isUploading ? 'Menyimpan...' : (isEditing ? 'Simpan Perubahan' : 'Publikasikan Artikel') }}\r\n      </AppButton>\r\n    </form>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, onMounted, computed } from 'vue';\r\nimport { useRoute, useRouter } from 'vue-router';\r\nimport { useStore } from 'vuex';\r\nimport ApiService from '@/services/ApiService';\r\nimport AppButton from '@/components/common/AppButton.vue';\r\n\r\nconst route = useRoute();\r\nconst router = useRouter();\r\nconst store = useStore();\r\n\r\nconst article = ref({\r\n  title: '',\r\n  content: '',\r\n  imageUrl: '',\r\n  category_id: '',\r\n});\r\nconst categories = ref([]);\r\nconst isEditing = computed(() => !!route.params.id);\r\n\r\n// ### LOGIKA BARU UNTUK NAMA PENULIS ###\r\nconst authorName = computed(() => store.getters['auth/currentUser']?.name || 'Admin');\r\n\r\n// State baru untuk upload gambar\r\nconst selectedFile = ref(null);\r\nconst imagePreview = ref('');\r\nconst isUploading = ref(false);\r\n\r\n// Fungsi untuk menangani pemilihan file\r\nconst handleFileChange = (event) => {\r\n  const file = event.target.files[0];\r\n  if (file) {\r\n    selectedFile.value = file;\r\n    // Buat URL sementara untuk ditampilkan sebagai preview\r\n    imagePreview.value = URL.createObjectURL(file);\r\n  }\r\n};\r\n\r\nonMounted(async () => {\r\n  // Ambil daftar kategori untuk dropdown\r\n  try {\r\n    const catResponse = await ApiService.getCategories();\r\n    categories.value = catResponse.data;\r\n  } catch (error) {\r\n    console.error(\"Gagal mengambil kategori:\", error);\r\n  }\r\n\r\n  // Jika ini mode edit, ambil data artikel yang ada\r\n  if (isEditing.value) {\r\n    try {\r\n      const artResponse = await ApiService.getArticle(route.params.id);\r\n      article.value = artResponse.data;\r\n    } catch (error) {\r\n      console.error(\"Gagal mengambil artikel untuk diedit:\", error);\r\n    }\r\n  }\r\n});\r\n\r\n// Fungsi yang dijalankan saat form disubmit\r\nconst handleSubmit = async () => {\r\n  isUploading.value = true;\r\n  let imageUrl = article.value.imageUrl; // Simpan URL gambar yang sudah ada (untuk mode edit)\r\n\r\n  // 1. Jika ada file baru yang dipilih, unggah dulu\r\n  if (selectedFile.value) {\r\n    const formData = new FormData();\r\n    formData.append('image', selectedFile.value);\r\n    try {\r\n      const uploadResponse = await ApiService.uploadImage(formData);\r\n      imageUrl = uploadResponse.data.imagePath; // Dapatkan path gambar baru dari backend\r\n    } catch (error) {\r\n      console.error(\"Gagal mengunggah gambar:\", error);\r\n      alert(\"Gagal mengunggah gambar. Pastikan file adalah gambar (jpg/png).\");\r\n      isUploading.value = false;\r\n      return;\r\n    }\r\n  }\r\n\r\n  // 2. Siapkan payload data artikel\r\n  const author_id = store.getters['auth/currentUser']?.id;\r\n  if (!author_id) {\r\n    alert(\"Sesi admin tidak valid. Silakan login ulang.\");\r\n    isUploading.value = false;\r\n    return;\r\n  }\r\n  const payload = { ...article.value, imageUrl, author_id };\r\n\r\n  // 3. Kirim data artikel ke backend (create atau update)\r\n  try {\r\n    if (isEditing.value) {\r\n      await ApiService.updateArticle(route.params.id, payload);\r\n    } else {\r\n      await ApiService.createArticle(payload);\r\n    }\r\n    // Arahkan kembali ke halaman manajemen artikel setelah berhasil\r\n    router.push('/admin/articles');\r\n  } catch (error) {\r\n    console.error(\"Gagal menyimpan artikel:\", error);\r\n    alert(\"Terjadi kesalahan saat menyimpan artikel.\");\r\n  } finally {\r\n    isUploading.value = false;\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.article-form {\r\n  background: white;\r\n  padding: 25px;\r\n  border-radius: 8px;\r\n  box-shadow: 0 2px 10px rgba(0,0,0,0.05);\r\n}\r\n.form-group {\r\n  margin-bottom: 20px;\r\n}\r\n.form-group label {\r\n  display: block;\r\n  margin-bottom: 8px;\r\n  font-weight: 600;\r\n}\r\n.form-group input,\r\n.form-group select,\r\n.form-group textarea {\r\n  width: 100%;\r\n  padding: 12px;\r\n  border: 1px solid #ccc;\r\n  border-radius: 4px;\r\n  font-size: 1rem;\r\n}\r\n/* Style untuk input yang dinonaktifkan */\r\n.form-group input:disabled {\r\n    background-color: #f0f0f0;\r\n    cursor: not-allowed;\r\n}\r\ntextarea {\r\n  min-height: 250px;\r\n  resize: vertical;\r\n}\r\n.image-preview {\r\n  margin-top: 15px;\r\n  border: 1px dashed #ccc;\r\n  padding: 10px;\r\n  border-radius: 8px;\r\n}\r\n.image-preview img {\r\n  max-width: 250px;\r\n  height: auto;\r\n  border-radius: 4px;\r\n  display: block;\r\n}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}